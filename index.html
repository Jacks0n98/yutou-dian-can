<!-- index.html -->
<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>å¤§å±±è„šèŠ‹å¤´é¥­ä¸“å–åº— ç‚¹é¤ç³»ç»Ÿ</title>
  <style>
    body { font-family: sans-serif; padding: 20px; background: #f5f5f5; }
    label, input, select, textarea { display: block; margin: 10px 0; }
    .group-block { padding: 10px; background: #fff; margin-bottom: 15px; border-radius: 6px; border: 1px solid #ccc; }
    button { padding: 10px 15px; }
    .output { white-space: pre-wrap; background: #eee; padding: 15px; border-radius: 5px; margin-top: 20px; }
  </style>
</head>
<body>
  <h2>å¤§å±±è„šèŠ‹å¤´é¥­ä¸“å–åº— ç‚¹é¤ç³»ç»Ÿ</h2>

  <label>ç”¨é¤äººæ•°ï¼š<input type="number" id="numPeople" min="1" value="1"></label>
  <label>å…±ç”¨æ±¤ç±³å‡ ç¢—ï¼š<input type="number" id="numSoups" min="1" value="1"></label>

  <div id="soupGroupArea"></div>

  <label>ç™½é¥­å‡ ç¢—ï¼š<input type="number" id="whiteRice" min="0" value="0"></label>
  <label>èŠ‹å¤´é¥­å‡ ç¢—ï¼š<input type="number" id="taroRice" min="0" value="0"></label>

  <label>æ€»ä½“è¯„è®ºï¼š<textarea id="remarks"></textarea></label>

  <button onclick="generateSoupGroups()">ç”Ÿæˆæ±¤åˆ†é…</button>
  <button onclick="submitOrder()">ä¸Šä¼ è®¢å•</button>

  <div id="summary" class="output"></div>

  <script>
    const ingredients = ["çŒªè‚", "çŒªè…°", "çŒªè‚ ", "çŒªè‚š", "çŒªèˆŒå¤´", "ç˜¦è‚‰", "è‚¥è‚‰", "èœ", "è‚‰ä¸¸"];
    let orderId = Number(localStorage.getItem("currentOrderId")) || 1;

    function generateSoupGroups() {
      const area = document.getElementById("soupGroupArea");
      const soupCount = parseInt(document.getElementById("numSoups").value);
      area.innerHTML = "";
      for (let i = 0; i < soupCount; i++) {
        const div = document.createElement("div");
        div.className = "group-block";
        div.innerHTML = `<h4>ç¬¬ ${i+1} ç¢—</h4>
          <label>å‡ ä½å…±ç”¨ï¼š<input type="number" name="group_people" min="1" value="1"></label>
          <label>ä¸åƒææ–™ï¼š</label>`;
        ingredients.forEach(item => {
          div.innerHTML += `<label><input type="checkbox" name="group_${i}_no" value="${item}"> ${item}</label>`;
        });
        area.appendChild(div);
      }
    }

    function submitOrder() {
      const people = document.getElementById("numPeople").value;
      const soupCount = parseInt(document.getElementById("numSoups").value);
      const white = document.getElementById("whiteRice").value;
      const taro = document.getElementById("taroRice").value;
      const remark = document.getElementById("remarks").value;

      const groups = [];
      for (let i = 0; i < soupCount; i++) {
        const num = document.getElementsByName("group_people")[i].value;
        const noItems = Array.from(document.querySelectorAll(`input[name="group_${i}_no"]:checked`)).map(cb => cb.value);
        groups.push({ bowl: i + 1, people: num, noItems });
      }

      const now = new Date();
      const dateStr = now.toISOString().split("T")[0];
      const order = {
        id: orderId,
        date: dateStr,
        people,
        white,
        taro,
        groups,
        remark
      };

      const orders = JSON.parse(localStorage.getItem("orders") || "[]");
      orders.push(order);
      localStorage.setItem("orders", JSON.stringify(orders));

      orderId = orderId >= 50 ? 1 : orderId + 1;
      localStorage.setItem("currentOrderId", orderId);

      let output = `è®¢å•ç¼–å·: ${order.id}\næ—¥æœŸ: ${dateStr}\nğŸ‘¥ ç”¨é¤äººæ•°: ${people} äºº\n\nğŸš é¥­é‡\n- ç™½é¥­: ${white} ç¢—\n- èŠ‹å¤´é¥­: ${taro} ç¢—\n\nğŸ² æ±¤åˆ†é…:`;
      groups.forEach(g => {
        output += `\n- ç¬¬ ${g.bowl} ç¢—ï¼š${g.people} äººï¼Œä¸åƒ: ${g.noItems.length ? g.noItems.join(", ") : "æ— "}`;
      });
      output += `\n\nå¤‡æ³¨: ${remark || "æ— "}`;

      document.getElementById("summary").textContent = output;
      alert("è®¢å•å·²ä¿å­˜åˆ°ç³»ç»Ÿ");
    }
  </script>
</body>
</html>
