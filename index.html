<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>å¤§å±±è„šèŠ‹å¤´é¥­ä¸“å–åº—</title>
  <style>
    body { font-family: sans-serif; margin: 0; padding: 20px; background: #fefefe; }
    h1, h2 { text-align: center; color: #5a2d0c; }
    .button { display: block; width: 100%; max-width: 300px; margin: 10px auto; padding: 15px; background: #8e5b3c; color: #fff; border: none; border-radius: 10px; font-size: 18px; cursor: pointer; }
    .section { display: none; }
    .person-block, .bowl-block { border: 1px solid #ccc; padding: 15px; margin: 10px 0; border-radius: 5px; background: #fff; }
    label { display: block; margin-top: 5px; }
    textarea { width: 100%; height: 40px; margin-top: 5px; }
    .output { white-space: pre-wrap; background: #eee; padding: 15px; border-radius: 5px; margin-top: 20px; }
    .back-btn { background: #aaa; }
  </style>
</head>
<body>

  <h1>ğŸ² å¤§å±±è„šèŠ‹å¤´é¥­ä¸“å–åº—</h1>

  <!-- é¦–é¡µèœå• -->
  <div id="homeSection">
    <button class="button" onclick="showSection('orderFormSection')">ğŸ“ åˆ›å»ºæ–°è®¢å•</button>
    <button class="button" onclick="showSection('orderListSection'); loadOrders()">ğŸ“‹ æŸ¥çœ‹è®¢å•æ€»è¡¨</button>
  </div>

  <!-- åˆ›å»ºè®¢å• -->
  <div id="orderFormSection" class="section">
    <button class="button back-btn" onclick="showSection('homeSection')">â¬… è¿”å›é¦–é¡µ</button>

    <label>è¯·è¾“å…¥ç”¨é¤äººæ•°ï¼š</label>
    <input type="number" id="numPeople" min="1" max="20" value="1"/>

    <label>è¯·è¾“å…¥æ€»å…±å‡ ç¢—æ±¤ï¼ˆå¯å¤šäººå…±ç”¨ï¼‰ï¼š</label>
    <input type="number" id="numBowls" min="1" max="10" value="1"/>

    <label>ç™½é¥­å‡ ç¢—ï¼š</label>
    <input type="number" id="whiteRice" min="0" value="0"/>

    <label>èŠ‹å¤´é¥­å‡ ç¢—ï¼š</label>
    <input type="number" id="yamRice" min="0" value="0"/>

    <button class="button" onclick="generateSoupBowlForms()">ä¸‹ä¸€æ­¥</button>

    <div id="soupFormsArea"></div>
    <div id="finalSubmitArea"></div>
  </div>

  <!-- æŸ¥çœ‹è®¢å•æ€»è¡¨ -->
  <div id="orderListSection" class="section">
    <button class="button back-btn" onclick="showSection('homeSection')">â¬… è¿”å›é¦–é¡µ</button>
    <h2>ğŸ“‹ è®¢å•æ€»è¡¨</h2>
    <div id="orderSummaryList" class="output"></div>
  </div>

  <script>
    const ingredients = ["çŒªè‚", "çŒªè…°", "çŒªè‚ ", "çŒªè‚š", "çŒªèˆŒå¤´", "ç˜¦è‚‰", "è‚¥è‚‰", "èœ", "è‚‰ä¸¸"];

    function showSection(id) {
      document.querySelectorAll(".section").forEach(div => div.style.display = "none");
      document.getElementById(id).style.display = "block";
    }

    function generateSoupBowlForms() {
      const numPeople = parseInt(document.getElementById("numPeople").value);
      const numBowls = parseInt(document.getElementById("numBowls").value);
      const area = document.getElementById("soupFormsArea");
      const finalArea = document.getElementById("finalSubmitArea");
      area.innerHTML = '';
      finalArea.innerHTML = '';

      for (let b = 0; b < numBowls; b++) {
        const div = document.createElement("div");
        div.className = "bowl-block";
        div.innerHTML = `<h3>ğŸ² ç¬¬ ${b + 1} ç¢—æ±¤</h3>`;
        div.innerHTML += `<label>è¿™ç¢—æ±¤å…±å‡ äººå…±ç”¨ï¼Ÿ</label>
          <input type="number" name="b${b}_count" min="1" max="${numPeople}" value="1" />`;

        for (let p = 0; p < numPeople; p++) {
          const pBlock = document.createElement("div");
          pBlock.className = "person-block";
          pBlock.innerHTML = `<strong>é¡¾å®¢ ${p + 1}ï¼ˆå¦‚å±äºæ­¤ç¢—æ±¤ï¼Œå¯å¡«å†™ï¼‰</strong><br>`;
          ingredients.forEach(item => {
            pBlock.innerHTML += `<label><input type="checkbox" name="b${b}_p${p}_no" value="${item}"> ä¸åƒ ${item}</label>`;
          });
          div.appendChild(pBlock);
        }

        area.appendChild(div);
      }

      const btn = document.createElement("button");
      btn.className = "button";
      btn.textContent = "âœ… æäº¤è®¢å•å¹¶ä¿å­˜";
      btn.onclick = submitFinalOrder;
      finalArea.appendChild(btn);
    }

    function submitFinalOrder() {
      const numPeople = parseInt(document.getElementById("numPeople").value);
      const numBowls = parseInt(document.getElementById("numBowls").value);
      const whiteRice = parseInt(document.getElementById("whiteRice").value);
      const yamRice = parseInt(document.getElementById("yamRice").value);
      const today = new Date().toISOString().slice(0, 10);

      // è·å–è½®è¯¢ç¼–å·
      let lastIndex = parseInt(localStorage.getItem("lastOrderIndex") || "0");
      lastIndex = lastIndex >= 50 ? 1 : lastIndex + 1;
      localStorage.setItem("lastOrderIndex", lastIndex);

      const summary = [];
      summary.push(`ğŸ§¾ è®¢å•æ—¥æœŸï¼š${today}`);
      summary.push(`ğŸ“Œ è®¢å•ç¼–å·ï¼š${lastIndex}`);
      summary.push(`ğŸ‘¥ ç”¨é¤äººæ•°ï¼š${numPeople}`);
      summary.push(`ğŸš ç™½é¥­ï¼š${whiteRice} ç¢—ï¼ŒèŠ‹å¤´é¥­ï¼š${yamRice} ç¢—`);
      summary.push(`ğŸ² æ±¤ç¢—æ•°ï¼š${numBowls} ç¢—\n`);

      for (let b = 0; b < numBowls; b++) {
        const bowlCount = document.querySelector(`input[name="b${b}_count"]`).value;
        summary.push(`ç¬¬ ${b + 1} ç¢—ï¼ˆå…± ${bowlCount} äººï¼‰ï¼š`);

        for (let p = 0; p < numPeople; p++) {
          const checkboxes = document.querySelectorAll(`input[name="b${b}_p${p}_no"]:checked`);
          if (checkboxes.length) {
            const avoid = Array.from(checkboxes).map(cb => cb.value).join("ã€");
            summary.push(` - é¡¾å®¢ ${p + 1} ä¸åƒï¼š${avoid}`);
          }
        }
        summary.push('');
      }

      // å­˜å‚¨è®¢å•
      const allOrders = JSON.parse(localStorage.getItem("orders") || "[]");
      allOrders.push({ id: lastIndex, date: today, content: summary.join('\n') });
      localStorage.setItem("orders", JSON.stringify(allOrders));

      alert("âœ… è®¢å•æäº¤æˆåŠŸï¼");
      showSection("orderListSection");
      loadOrders();
    }

    function loadOrders() {
      const listDiv = document.getElementById("orderSummaryList");
      const allOrders = JSON.parse(localStorage.getItem("orders") || "[]");
      if (!allOrders.length) {
        listDiv.textContent = "æš‚æ— è®¢å•ã€‚";
        return;
      }
      const text = allOrders.map(o => o.content).join("\n----------------------\n\n");
      listDiv.textContent = text;
    }

    // é»˜è®¤æ˜¾ç¤ºé¦–é¡µ
    showSection("homeSection");
  </script>
</body>
</html>

