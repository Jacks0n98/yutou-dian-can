<!-- index.html -->
<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>大山脚芋头饭专卖店 点餐系统</title>
  <style>
    body { font-family: sans-serif; padding: 20px; background: #f5f5f5; }
    label, input, select, textarea { display: block; margin: 10px 0; }
    .group-block { padding: 10px; background: #fff; margin-bottom: 15px; border-radius: 6px; border: 1px solid #ccc; }
    button { padding: 10px 15px; }
    .output { white-space: pre-wrap; background: #eee; padding: 15px; border-radius: 5px; margin-top: 20px; }
  </style>
</head>
<body>
  <h2>大山脚芋头饭专卖店 点餐系统</h2>

  <label>用餐人数：<input type="number" id="numPeople" min="1" value="1"></label>
  <label>共用汤米几碗：<input type="number" id="numSoups" min="1" value="1"></label>

  <div id="soupGroupArea"></div>

  <label>白饭几碗：<input type="number" id="whiteRice" min="0" value="0"></label>
  <label>芋头饭几碗：<input type="number" id="taroRice" min="0" value="0"></label>

  <label>总体评论：<textarea id="remarks"></textarea></label>

  <button onclick="generateSoupGroups()">生成汤分配</button>
  <button onclick="submitOrder()">上传订单</button>

  <div id="summary" class="output"></div>

  <script>
    const ingredients = ["猪肝", "猪腰", "猪肠", "猪肚", "猪舌头", "瘦肉", "肥肉", "菜", "肉丸"];
    let orderId = Number(localStorage.getItem("currentOrderId")) || 1;

    function generateSoupGroups() {
      const area = document.getElementById("soupGroupArea");
      const soupCount = parseInt(document.getElementById("numSoups").value);
      area.innerHTML = "";
      for (let i = 0; i < soupCount; i++) {
        const div = document.createElement("div");
        div.className = "group-block";
        div.innerHTML = `<h4>第 ${i+1} 碗</h4>
          <label>几位共用：<input type="number" name="group_people" min="1" value="1"></label>
          <label>不吃材料：</label>`;
        ingredients.forEach(item => {
          div.innerHTML += `<label><input type="checkbox" name="group_${i}_no" value="${item}"> ${item}</label>`;
        });
        area.appendChild(div);
      }
    }

    function submitOrder() {
      const people = document.getElementById("numPeople").value;
      const soupCount = parseInt(document.getElementById("numSoups").value);
      const white = document.getElementById("whiteRice").value;
      const taro = document.getElementById("taroRice").value;
      const remark = document.getElementById("remarks").value;

      const groups = [];
      for (let i = 0; i < soupCount; i++) {
        const num = document.getElementsByName("group_people")[i].value;
        const noItems = Array.from(document.querySelectorAll(`input[name="group_${i}_no"]:checked`)).map(cb => cb.value);
        groups.push({ bowl: i + 1, people: num, noItems });
      }

      const now = new Date();
      const dateStr = now.toISOString().split("T")[0];
      const order = {
        id: orderId,
        date: dateStr,
        people,
        white,
        taro,
        groups,
        remark
      };

      const orders = JSON.parse(localStorage.getItem("orders") || "[]");
      orders.push(order);
      localStorage.setItem("orders", JSON.stringify(orders));

      orderId = orderId >= 50 ? 1 : orderId + 1;
      localStorage.setItem("currentOrderId", orderId);

      let output = `订单编号: ${order.id}\n日期: ${dateStr}\n👥 用餐人数: ${people} 人\n\n🍚 饭量\n- 白饭: ${white} 碗\n- 芋头饭: ${taro} 碗\n\n🍲 汤分配:`;
      groups.forEach(g => {
        output += `\n- 第 ${g.bowl} 碗：${g.people} 人，不吃: ${g.noItems.length ? g.noItems.join(", ") : "无"}`;
      });
      output += `\n\n备注: ${remark || "无"}`;

      document.getElementById("summary").textContent = output;
      alert("订单已保存到系统");
    }
  </script>
</body>
</html>
