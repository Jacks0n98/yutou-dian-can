<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å¤§å±±è„šèŠ‹å¤´é¥­ä¸“å–åº— ç‚¹é¤ç³»ç»Ÿ</title>
  <style>
    body { font-family: sans-serif; padding: 20px; background: #f8f8f8; }
    h2 { color: #5a2d0c; }
    label { display: block; margin-top: 8px; }
    input[type="number"] { width: 60px; }
    textarea { width: 100%; height: 50px; margin-top: 5px; }
    .block { background: #fff; padding: 15px; margin-top: 15px; border-radius: 6px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
    .output { white-space: pre-wrap; background: #eee; padding: 15px; border-radius: 6px; margin-top: 20px; }
    button { margin-top: 20px; padding: 10px 15px; font-size: 16px; }
  </style>
</head>
<body>

  <h2>å¤§å±±è„šèŠ‹å¤´é¥­ä¸“å–åº— ç‚¹é¤ç³»ç»Ÿ</h2>

  <label>ğŸ‘¥ ç”¨é¤äººæ•°ï¼š<input type="number" id="numPeople" min="1" value="1"></label>

  <label>ğŸ¥£ æ±¤ç±»é€‰æ‹©ï¼š</label>
  <label><input type="radio" name="soupType" value="single" checked> æ¯äººä¸€ç¢—</label>
  <label><input type="radio" name="soupType" value="shared"> å…±ç”¨å‡ ç¢—</label>

  <div id="soupConfig"></div>

  <div class="block">
    <h3>â˜•ï¸ é¥­ç±»ç»Ÿè®¡</h3>
    <label>ğŸš ç™½é¥­æ•°é‡ï¼š<input type="number" id="riceWhite" min="0" value="0"> ç¢—</label>
    <label>ğŸ¥  èŠ‹å¤´é¥­æ•°é‡ï¼š<input type="number" id="riceTaro" min="0" value="0"> ç¢—</label>
    <label>ğŸ“Œ é¥­ç±»å¤‡æ³¨ï¼š<textarea id="riceNote"></textarea></label>
  </div>

  <div class="block">
    <h3>è®¾ç½®å„ä½é¡¹ç›®</h3>
    <div id="remarkArea"></div>
  </div>

  <button onclick="generateForm()">ç”Ÿæˆå¡«è¡¨</button>
  <button onclick="generateSummary()">ç”Ÿæˆç‚¹é¤æ€»ç»“</button>

  <div class="output" id="summary"></div>

  <script>
    const ingredients = ["çŒªè‚", "çŒªè…°", "çŒªè‚ ", "çŒªè‚š", "çŒªèˆŒå¤´", "ç˜¦è‚‰", "è‚¥è‚‰", "èœ", "è‚‰ä¸¸"];
    let soupGroups = [];
    let orderNumber = parseInt(localStorage.getItem('orderNumber') || '0');

    function generateForm() {
      const num = parseInt(document.getElementById("numPeople").value);
      const soupType = document.querySelector('input[name="soupType"]:checked').value;
      const soupConfig = document.getElementById("soupConfig");
      const remarkArea = document.getElementById("remarkArea");
      soupConfig.innerHTML = '';
      remarkArea.innerHTML = '';

      if (soupType === 'shared') {
        const block = document.createElement('div');
        block.className = "block";
        block.innerHTML = `<label>ğŸ¥£ è¾“å…¥å…±ç”¨çš„æ±¤ç¢—æ•°ï¼š<input type="number" id="soupBowls" min="1" value="1"></label>
          <button onclick="generateSoupGroups()">è®¾ç½®æ¯ç¢—åˆ†ç»„</button>
          <div id="soupGroupInputs"></div>`;
        soupConfig.appendChild(block);
      }

      for (let i = 0; i < num; i++) {
        const div = document.createElement("div");
        div.className = "block";
        div.innerHTML = `ğŸ‘¤ é¡¹ç›® - é¡¾å®¢ ${i + 1}<br><textarea id="remark_${i}" placeholder="å¤‡æ³¨ä¿¡æ¯..."></textarea>`;
        remarkArea.appendChild(div);
      }
    }

    function generateSoupGroups() {
      const bowls = parseInt(document.getElementById("soupBowls").value);
      const container = document.getElementById("soupGroupInputs");
      soupGroups = [];
      container.innerHTML = '';

      for (let i = 0; i < bowls; i++) {
        const block = document.createElement('div');
        block.className = "block";
        block.innerHTML = `<h4>ğŸ¥£ æ±¤${i + 1}</h4>
          <label>å…±ç”¨äººæ•°ï¼š<input type="number" id="soup_${i}_count" min="1" value="1"></label>
          <label>ä¸åƒææ–™ï¼š</label>
          ${ingredients.map(item => `<label><input type="checkbox" name="soup_${i}_no" value="${item}"> ${item}</label>`).join('')}`;
        container.appendChild(block);
      }
    }

    function generateSummary() {
      const num = parseInt(document.getElementById("numPeople").value);
      const soupType = document.querySelector('input[name="soupType"]:checked').value;
      const white = parseInt(document.getElementById("riceWhite").value);
      const taro = parseInt(document.getElementById("riceTaro").value);
      const riceNote = document.getElementById("riceNote").value.trim();
      const remarks = Array.from({ length: num }, (_, i) => document.getElementById(`remark_${i}`).value.trim());
      let summary = [];

      orderNumber = (orderNumber % 50) + 1;
      localStorage.setItem('orderNumber', orderNumber);

      const today = new Date().toLocaleDateString();
      summary.push(`ğŸ“… æ—¥æœŸï¼š${today}   è®¢å•å·ï¼š#${orderNumber}`);
      summary.push(`ğŸ‘¥ ç”¨é¤äººæ•°ï¼š${num} äºº`);

      if (soupType === 'single') {
        summary.push(`ğŸ¥£ æ¯äººä¸€ç¢—`);
        for (let i = 0; i < num; i++) {
          summary.push(`ğŸ² é¡¾å®¢${i + 1} ä¸åƒï¼šæ— `);
        }
      } else {
        summary.push(`ğŸ¥£ å…±ç”¨æ±¤æ„æˆï¼š`);
        const bowls = parseInt(document.getElementById("soupBowls").value);
        let totalCount = 0;
        for (let i = 0; i < bowls; i++) {
          const count = parseInt(document.getElementById(`soup_${i}_count`).value);
          totalCount += count;
          const noItems = Array.from(document.querySelectorAll(`input[name="soup_${i}_no"]:checked`)).map(cb => cb.value);
          summary.push(`  ã€ğŸ¥£ æ±¤${i + 1}ã€‘ ${count}äººå…±ç”¨  ä¸åƒï¼š${noItems.length ? noItems.join(' ã€') : "æ— "}`);
        }
        if (totalCount !== num) {
          alert("[é”™è¯¯] æ±¤åˆ†ç»„äººæ•°æ€»å’Œä¸ç­‰äºç”¨é¤äººæ•°ï¼");
          return;
        }
      }

      summary.push("\nğŸš é¥­ç±»ç»Ÿè®¡ï¼š");
      summary.push(`  ğŸš ç™½é¥­ï¼š${white}ç¢—`);
      summary.push(`  ğŸ¥  èŠ‹å¤´é¥­ï¼š${taro}ç¢—`);
      if (riceNote) summary.push(`  ğŸ“Œ å¤‡æ³¨ï¼š${riceNote}`);

      summary.push("\nğŸ“„ é¡¾å®¢å¤‡æ³¨ï¼š");
      remarks.forEach((r, i) => {
        if (r) summary.push(`  ğŸ‘¤ é¡¾å®¢${i + 1}ï¼š${r}`);
      });

      document.getElementById("summary").textContent = summary.join("\n");
    }
  </script>

</body>
</html>
