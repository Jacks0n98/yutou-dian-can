<!-- ğŸ“„ index.html -->
<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å¤§å±±è„šèŠ‹å¤´é¥­ä¸“å–åº— ç‚¹é¤ç³»ç»Ÿ</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #f9f9f9; }
    h2 { color: #5a2d0c; }
    .person-block { border: 1px solid #ccc; padding: 15px; margin-bottom: 20px; background: #fff; border-radius: 5px; }
    label { display: block; margin-top: 5px; }
    textarea { width: 100%; height: 50px; margin-top: 5px; }
    .output { white-space: pre-wrap; background: #eee; padding: 15px; border-radius: 5px; margin-top: 20px; }
    button { margin-top: 20px; padding: 10px 15px; }
  </style>
</head>
<body>

<h2>å¤§å±±è„šèŠ‹å¤´é¥­ä¸“å–åº— ç‚¹é¤ç³»ç»Ÿ</h2>

<label for="numPeople">è¯·è¾“å…¥ç”¨é¤äººæ•°ï¼š</label>
<input type="number" id="numPeople" min="1" max="10" value="1">
<br><br>
<label><input type="radio" name="soupType" value="individual" checked> æ¯äººä¸€ç¢—æ±¤</label>
<label><input type="radio" name="soupType" value="shared"> å…±ç”¨ä¸€ç¢—æ±¤</label>

<button onclick="generateForm()">ä¸‹ä¸€æ­¥</button>

<div id="formArea"></div>
<div id="summaryArea"></div>

<script>
const ingredients = ["çŒªè‚", "çŒªè…°", "çŒªè‚ ", "çŒªè‚š", "çŒªèˆŒå¤´", "ç˜¦è‚‰", "è‚¥è‚‰", "èœ", "è‚‰ä¸¸"];
let orderCounter = parseInt(localStorage.getItem("orderCounter")) || 1;

function generateForm() {
  const num = parseInt(document.getElementById("numPeople").value);
  const area = document.getElementById("formArea");
  const summaryArea = document.getElementById("summaryArea");
  area.innerHTML = '';
  summaryArea.innerHTML = '';

  for (let i = 0; i < num; i++) {
    const div = document.createElement("div");
    div.className = "person-block";
    div.innerHTML = `<h3>é¡¾å®¢ ${i + 1}</h3>`;

    div.innerHTML += `<strong>ä¸åƒçš„ææ–™ï¼š</strong><br>`;
    ingredients.forEach(item => {
      div.innerHTML += `<label><input type="checkbox" name="p${i}_no" value="${item}"> ${item}</label>`;
    });

    div.innerHTML += `<br><strong>é¥­ç±»ï¼š</strong><br>
      <label><input type="radio" name="p${i}_rice" value="ç™½é¥­" checked> ç™½é¥­</label>
      <label><input type="radio" name="p${i}_rice" value="èŠ‹å¤´é¥­"> èŠ‹å¤´é¥­</label>`;

    div.innerHTML += `<br><strong>é¥­é‡ï¼š</strong><br>
      <label><input type="radio" name="p${i}_portion" value="æ­£å¸¸é¥­é‡" checked> æ­£å¸¸é¥­é‡</label>
      <label><input type="radio" name="p${i}_portion" value="å°‘é¥­"> å°‘é¥­</label>
      <label><input type="radio" name="p${i}_portion" value="åŠ é¥­"> åŠ é¥­</label>`;

    div.innerHTML += `<br><label>å¤‡æ³¨ï¼š</label><textarea name="p${i}_remark"></textarea>`;

    area.appendChild(div);
  }

  const btn = document.createElement("button");
  btn.textContent = "ç”Ÿæˆç‚¹é¤ç»“æœå¹¶æäº¤è®¢å•";
  btn.onclick = generateSummary;
  area.appendChild(btn);
}

function generateSummary() {
  const summary = [];
  const num = parseInt(document.getElementById("numPeople").value);
  const soupType = document.querySelector('input[name="soupType"]:checked').value;
  let sharedAvoid = new Set();

  summary.push(`å¤§å±±è„šèŠ‹å¤´é¥­ä¸“å–åº— - ä»Šæ—¥è®¢å•`);
  const now = new Date();
  const timestamp = now.toLocaleString();
  summary.push(`ğŸ•’ æ—¶é—´ï¼š${timestamp}`);
  summary.push(`ğŸ‘¥ ç”¨é¤äººæ•°ï¼š${num}äºº`);
  summary.push(`ğŸ² æ±¤ç±»ï¼š${soupType === 'individual' ? 'æ¯äººä¸€ç¢—' : 'å…±ç”¨ä¸€ç¢—'}\n`);

  for (let i = 0; i < num; i++) {
    const noItems = Array.from(document.querySelectorAll(`input[name="p${i}_no"]:checked`)).map(cb => cb.value);
    if (soupType === 'shared') noItems.forEach(item => sharedAvoid.add(item));
    const rice = document.querySelector(`input[name="p${i}_rice"]:checked`).value;
    const portion = document.querySelector(`input[name="p${i}_portion"]:checked`).value;
    const remark = document.querySelector(`textarea[name="p${i}_remark"]`).value.trim();

    summary.push(`ğŸ‘¤ é¡¾å®¢${i + 1}ï¼š`);
    summary.push(`  ä¸åƒï¼š${noItems.length ? noItems.join("ã€") : "æ— ç‰¹åˆ«å¿Œå£"}`);
    summary.push(`  é¥­ç±»ï¼š${rice}ï¼ˆ${portion}ï¼‰`);
    summary.push(`  å¤‡æ³¨ï¼š${remark || "æ— "}`);
    summary.push('');
  }

  if (soupType === 'shared') {
    summary.push(`âš ï¸ å…±ç”¨æ±¤ç±»ï¼Œä»¥ä¸‹ææ–™éœ€ç»Ÿä¸€å»é™¤ï¼š`);
    summary.push(sharedAvoid.size ? [...sharedAvoid].join("ã€") : "æ— å¿Œå£");
    summary.push('');
  }

  const finalText = summary.join('\n');
  document.getElementById("summaryArea").innerHTML = `<div class="output">${finalText}</div>`;

  const orderData = {
    id: orderCounter,
    time: timestamp,
    content: finalText
  };

  let orders = JSON.parse(localStorage.getItem("yutou_orders") || "[]");
  const index = (orderCounter - 1) % 50;
  orders[index] = orderData;
  localStorage.setItem("yutou_orders", JSON.stringify(orders));

  orderCounter = orderCounter % 50 + 1;
  localStorage.setItem("orderCounter", orderCounter);

  alert(`âœ… è®¢å•æäº¤æˆåŠŸï¼è®¢å•ç¼–å·ï¼š#${orderData.id}`);
}
</script>

</body>
</html>
